---
phase: 05-dead-code-cleanup-integration
plan: 03
type: execute
wave: 1
depends_on: ["05-02"]
files_modified:
  - src/cli/check.ts
  - src/cli/push.ts
  - src/cli/pull.ts
  - src/cli/cli-helpers.ts
  - src/cli/diff.ts
  - src/cli/__tests__/orchestrator.test.ts
  - src/cli/__tests__/stale-and-pull.test.ts
autonomous: true
requirements: []
gap_closure: true

must_haves:
  truths:
    - "CLI modules are named check.ts, push.ts, pull.ts (no sync- prefix)"
    - "orchestrator.ts facade is deleted (zero importers)"
    - "confirm() is defined once in cli-helpers.ts, not duplicated"
    - "All 414+ tests pass after rename"
  artifacts:
    - path: "src/cli/check.ts"
      provides: "runCheck + checkCommand (merged)"
      contains: "export async function runCheck"
    - path: "src/cli/push.ts"
      provides: "runPush + pushCommand (merged)"
      contains: "export async function runPush"
    - path: "src/cli/pull.ts"
      provides: "runPull + runPullAll + pullCommand (merged)"
      contains: "export async function runPull"
    - path: "src/cli/cli-helpers.ts"
      provides: "shared confirm() + validation helpers"
      contains: "export async function confirm"
  key_links:
    - from: "src/cli/push.ts"
      to: "src/cli/check.ts"
      via: "import { runCheck }"
      pattern: "from './check'"
    - from: "src/cli/diff.ts"
      to: "src/cli/check.ts"
      via: "import { runCheck }"
      pattern: "from './check'"
    - from: "src/cli/index.ts"
      to: "src/cli/check.ts, src/cli/push.ts, src/cli/pull.ts"
      via: "import { checkCommand, pushCommand, pullCommand }"
      pattern: "from './(check|push|pull)'"
---

<objective>
Close UAT gap: rename sync-check/sync-push/sync-pull to check/push/pull by merging Commander wrapper code into the logic modules, deleting orchestrator.ts dead code, and extracting duplicated confirm().

Purpose: User wants clean module names (check.ts, push.ts, pull.ts) without the sync- prefix that was only needed to avoid filename collision with the Commander wrapper files.
Output: Three merged modules, updated imports, deleted dead code.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dead-code-cleanup-integration/05-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract confirm(), delete orchestrator.ts, merge wrappers into logic modules</name>
  <files>
    src/cli/cli-helpers.ts
    src/cli/orchestrator.ts
    src/cli/sync-check.ts
    src/cli/sync-push.ts
    src/cli/sync-pull.ts
    src/cli/check.ts
    src/cli/push.ts
    src/cli/pull.ts
  </files>
  <action>
**Step 1 — Extract confirm() to cli-helpers.ts:**
Add `import { createInterface } from 'node:readline';` at top of cli-helpers.ts. Add this exported function:

```ts
export async function confirm(question: string): Promise<boolean> {
  const rl = createInterface({ input: process.stdin, output: process.stdout });
  return new Promise((resolve) => {
    rl.question(`${question} [y/N] `, (answer) => {
      rl.close();
      resolve(answer.trim().toLowerCase() === 'y' || answer.trim().toLowerCase() === 'yes');
    });
  });
}
```

**Step 2 — Delete orchestrator.ts:**
Delete `src/cli/orchestrator.ts`. It has zero importers (confirmed via grep — only its own file references the sync-* modules via re-exports, and nothing imports from orchestrator).

**Step 3 — Build new check.ts (merge sync-check.ts logic + old check.ts Commander code):**
Create new `src/cli/check.ts` that contains:
1. ALL content from current `sync-check.ts` (lines 1-290: imports, OrchestratorCheckResult interface, detectStaleItems function, runCheck function)
2. PLUS the Commander wrapper from old `check.ts` (the `checkCommand` definition using Commander, importing from cli-helpers)
3. The `checkCommand` now imports `runCheck` from the same file (no import needed — it's in-scope)
4. Update the import of `runCheck` in the Commander action: remove `import { runCheck } from './sync-check'` — `runCheck` is now local
5. Keep the `import { mapTargets, mapTypes, collect, validateTargets, validateTypes } from './cli-helpers'` import
6. Add `import { Command } from 'commander'` to the imports

The file should export both `runCheck`, `OrchestratorCheckResult` (for other modules) and `checkCommand` (for index.ts).

Expected ~320 LOC. Under 500 LOC limit.

**Step 4 — Build new push.ts (merge sync-push.ts logic + old push.ts Commander code):**
Create new `src/cli/push.ts` that contains:
1. ALL content from current `sync-push.ts` (lines 1-215: imports, OrchestratorPushResult interface, runPush function)
2. PLUS the Commander wrapper from old `push.ts` (pushCommand definition)
3. Change `import { runCheck } from './sync-check'` to `import { runCheck } from './check'`
4. Remove old `import { runPush } from './sync-push'` — `runPush` is now local
5. Replace local `confirm()` function with `import { confirm } from './cli-helpers'`
6. Add `import { Command } from 'commander'` and `import { mapTargets, mapTypes, collect, validateTargets, validateTypes } from './cli-helpers'`

The file should export both `runPush`, `OrchestratorPushResult` (for other modules) and `pushCommand` (for index.ts).

Expected ~265 LOC. Under 500 LOC limit.

**Step 5 — Build new pull.ts (merge sync-pull.ts logic + old pull.ts Commander code):**
Create new `src/cli/pull.ts` that contains:
1. ALL content from current `sync-pull.ts` (lines 1-361: imports, interfaces, runPull, runPullAll, formatPullAllResult, formatPullResult)
2. PLUS the Commander wrapper from old `pull.ts` (pullCommand definition)
3. Remove old `import { runPull, runPullAll } from './sync-pull'` — they're now local
4. Replace local `confirm()` function with `import { confirm } from './cli-helpers'`
5. Add `import { Command } from 'commander'` and `import { validatePullSource } from './cli-helpers'` (already imported in sync-pull context)

The file should export `runPull`, `runPullAll`, `PullOptions`, `PullItem`, `OrchestratorPullResult`, `PullAllOptions` (for other modules) and `pullCommand` (for index.ts).

Expected ~411 LOC. Under 500 LOC limit.

**Step 6 — Delete old files:**
Delete `src/cli/sync-check.ts`, `src/cli/sync-push.ts`, `src/cli/sync-pull.ts`. Their content is now merged into check.ts, push.ts, pull.ts respectively.

**IMPORTANT NOTES:**
- `src/cli/index.ts` already imports `from './check'`, `from './push'`, `from './pull'` — NO CHANGES needed there. After the merge+rename, these imports resolve to the new merged files.
- Do NOT create any new re-export facade. The merged files ARE the final modules.
- Each merged file must have `#!/usr/bin/env bun` shebang at top (from the Commander wrappers).
  </action>
  <verify>
    - `ls src/cli/orchestrator.ts` returns "No such file"
    - `ls src/cli/sync-check.ts src/cli/sync-push.ts src/cli/sync-pull.ts` all return "No such file"
    - `ls src/cli/check.ts src/cli/push.ts src/cli/pull.ts` all exist
    - `wc -l src/cli/check.ts` is ~320, under 500
    - `wc -l src/cli/push.ts` is ~265, under 500
    - `wc -l src/cli/pull.ts` is ~411, under 500
    - `rg "sync-check|sync-push|sync-pull" src/cli/check.ts src/cli/push.ts src/cli/pull.ts` returns nothing
    - `rg "async function confirm" src/cli/push.ts src/cli/pull.ts` returns nothing (confirm is in cli-helpers.ts only)
  </verify>
  <done>
    Three merged modules exist at check.ts, push.ts, pull.ts. orchestrator.ts deleted. sync-* files deleted. confirm() deduplicated to cli-helpers.ts. All under 500 LOC.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update imports in diff.ts and test files, run full test suite</name>
  <files>
    src/cli/diff.ts
    src/cli/__tests__/orchestrator.test.ts
    src/cli/__tests__/stale-and-pull.test.ts
  </files>
  <action>
**Step 1 — Update diff.ts:**
Change line 13 from:
```ts
import { runCheck } from './sync-check';
```
to:
```ts
import { runCheck } from './check';
```

**Step 2 — Update orchestrator.test.ts:**
Change line 6-7 from:
```ts
import { runCheck } from '../sync-check';
import { runPush } from '../sync-push';
```
to:
```ts
import { runCheck } from '../check';
import { runPush } from '../push';
```

**Step 3 — Update stale-and-pull.test.ts:**
Change lines 5-6 from:
```ts
import { runCheck } from '../sync-check';
import { runPull, runPullAll } from '../sync-pull';
```
to:
```ts
import { runCheck } from '../check';
import { runPull, runPullAll } from '../pull';
```

**Step 4 — Verify no remaining references:**
Run `rg "sync-check|sync-push|sync-pull|orchestrator" src/ -g '*.ts'` — should return zero results.

**Step 5 — Run full test suite:**
Run `bun test`. All 414+ tests must pass.
  </action>
  <verify>
    - `rg "sync-check|sync-push|sync-pull|orchestrator" src/ -g '*.ts'` returns nothing
    - `bun test` passes with 0 failures
  </verify>
  <done>
    All imports updated. No references to sync-* or orchestrator remain. Full test suite passes.
  </done>
</task>

</tasks>

<verification>
1. `ls src/cli/check.ts src/cli/push.ts src/cli/pull.ts` — all exist
2. `ls src/cli/sync-check.ts src/cli/sync-push.ts src/cli/sync-pull.ts src/cli/orchestrator.ts 2>&1` — all "No such file"
3. `wc -l src/cli/check.ts src/cli/push.ts src/cli/pull.ts` — all under 500 LOC
4. `rg "sync-check|sync-push|sync-pull|orchestrator" src/ -g '*.ts'` — zero matches
5. `rg "async function confirm" src/cli/` — only in cli-helpers.ts
6. `bun test` — 0 failures, 414+ tests pass
</verification>

<success_criteria>
- CLI modules named check.ts, push.ts, pull.ts (no sync- prefix)
- orchestrator.ts deleted
- confirm() deduplicated to cli-helpers.ts
- All tests pass
- All files under 500 LOC
</success_criteria>

<output>
After completion, create `.planning/phases/05-dead-code-cleanup-integration/05-03-SUMMARY.md`
</output>
