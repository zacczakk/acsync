---
phase: 10-fixtures-infrastructure-test-health
plan: 03
subsystem: testing
tags: [fixtures, golden-files, smoke-test, adapters, backup-harness]

requires:
  - phase: 10-02
    provides: "Canonical fixture files + withBackup harness"
provides:
  - "Per-target golden fixture files for all 4 CLI targets (test/fixtures/{claude,opencode,gemini,codex}/)"
  - "Golden file generation script (test/generate-golden.ts)"
  - "Smoke test validating fixture completeness, golden accuracy, and backup harness (test/__tests__/fixtures-smoke.test.ts)"
affects: [11-e2e-tests, 12-regression-tests]

tech-stack:
  added: []
  patterns: ["golden file testing via adapter re-rendering", "programmatic fixture generation script"]

key-files:
  created:
    - test/generate-golden.ts
    - test/__tests__/fixtures-smoke.test.ts
    - test/fixtures/claude/commands/groom-docs.md
    - test/fixtures/claude/agents/test-agent.md
    - test/fixtures/claude/skills/obsidian/SKILL.md
    - test/fixtures/claude/instructions/CLAUDE.md
    - test/fixtures/opencode/commands/groom-docs.md
    - test/fixtures/opencode/agents/test-agent.md
    - test/fixtures/opencode/instructions/AGENTS.md
    - test/fixtures/gemini/commands/groom-docs.toml
    - test/fixtures/gemini/agents/test-agent.md
    - test/fixtures/gemini/instructions/AGENTS.md
    - test/fixtures/codex/commands/groom-docs.md
    - test/fixtures/codex/agents/agent-test-agent.md
    - test/fixtures/codex/instructions/AGENTS.md
  modified: []

key-decisions:
  - "Golden files generated by running actual renderers — guarantees accuracy"
  - "Generation script kept as dev tool for regenerating when renderers change"

patterns-established:
  - "Golden file pattern: canonical → adapter.render() → compare committed output"
  - "Smoke test validates fixture infra before E2E tests depend on it"

requirements-completed: [FIX-03, FIX-07]

duration: 4min
completed: 2026-02-25
---

# Phase 10 Plan 03: Per-Target Golden Fixtures & Smoke Test Summary

**Per-target golden fixture files generated via actual adapter rendering plus smoke test validating fixture completeness, golden accuracy, and withBackup harness**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-25T09:50:05Z
- **Completed:** 2026-02-25T09:55:02Z
- **Tasks:** 2
- **Files modified:** 30

## Accomplishments
- Generated 28 golden fixture files across 4 targets (commands, agents, skills, instructions)
- Generation script (`test/generate-golden.ts`) renders canonical fixtures through actual adapters
- Smoke test with 37 tests validates fixture completeness, golden file accuracy, and withBackup harness
- Full suite passes at 439 tests with zero regressions

## Task Commits

Each task was committed atomically:

1. **Task 1: Generate per-target golden fixture files via renderers** - `9c92805` (feat)
2. **Task 2: Write smoke test for fixture infrastructure and backup harness** - `3aeb7c4` (test)

## Files Created/Modified
- `test/generate-golden.ts` - One-shot script to render canonical fixtures through all 4 adapters
- `test/__tests__/fixtures-smoke.test.ts` - 37-test smoke suite for fixture infra + backup harness
- `test/fixtures/claude/` - Claude golden files (verbatim passthrough, CLAUDE.md instructions)
- `test/fixtures/opencode/` - OpenCode golden files (description-only commands, mode:subagent agents)
- `test/fixtures/gemini/` - Gemini golden files (TOML commands, kind:local agents)
- `test/fixtures/codex/` - Codex golden files (flat markdown commands, agent-prefixed agents)

## Decisions Made
- Golden files generated by running actual renderers rather than hand-crafting — guarantees they match real renderer output
- Generation script kept as a dev tool for future regeneration when renderers change

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- All 3 plans in Phase 10 complete
- Fixture infrastructure fully operational for Phase 11-12 E2E tests
- 439 tests passing, zero regressions

## Self-Check: PASSED

- All 30 created files verified via git log
- Commits 9c92805 and 3aeb7c4 found in git log

---
*Phase: 10-fixtures-infrastructure-test-health*
*Completed: 2026-02-25*
