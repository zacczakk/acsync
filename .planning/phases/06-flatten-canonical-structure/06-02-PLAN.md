---
phase: 06-flatten-canonical-structure
plan: 02
type: execute
wave: 1
depends_on: ["06-01"]
files_modified:
  - README.md
  - src/cli/render.ts
  - src/cli/pull.ts
  - src/cli/check.ts
autonomous: true
gap_closure: true
requirements: [STRUCT-02]

must_haves:
  truths:
    - "README.md references configs/ (not configs/common/) in all setup instructions and directory layout"
    - "render.ts, pull.ts, check.ts import path constants from canonical.ts instead of hardcoding 'configs' strings"
    - "All exported path constants from canonical.ts (COMMANDS_DIR, AGENTS_DIR, etc.) are imported by at least one consumer"
  artifacts:
    - path: "README.md"
      provides: "Updated setup instructions and directory layout"
      contains: "configs/commands"
    - path: "src/cli/render.ts"
      provides: "Renders using imported path constants"
    - path: "src/cli/pull.ts"
      provides: "Pull using imported path constants"
    - path: "src/cli/check.ts"
      provides: "Check using imported path constants"
  key_links:
    - from: "src/cli/render.ts"
      to: "src/cli/canonical.ts"
      via: "import { COMMANDS_DIR, AGENTS_DIR, ... }"
      pattern: "import.*COMMANDS_DIR.*from.*canonical"
    - from: "src/cli/pull.ts"
      to: "src/cli/canonical.ts"
      via: "import { COMMANDS_DIR, AGENTS_DIR, SKILLS_DIR }"
      pattern: "import.*COMMANDS_DIR.*from.*canonical"
    - from: "src/cli/check.ts"
      to: "src/cli/canonical.ts"
      via: "import { COMMANDS_DIR, AGENTS_DIR }"
      pattern: "import.*COMMANDS_DIR.*from.*canonical"
---

<objective>
Close 2 verification gaps from 06-VERIFICATION.md: fix stale README.md references and wire path constants into render.ts, pull.ts, check.ts.

Purpose: Complete STRUCT-02 (all path references updated) and achieve single-source-of-truth pattern for canonical paths.
Output: 4 files updated, zero `configs/common/` references anywhere, all hardcoded `'configs'` join() calls replaced with imported constants.
</objective>

<execution_context>
@/Users/m332023/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/m332023/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-flatten-canonical-structure/06-01-SUMMARY.md
@.planning/phases/06-flatten-canonical-structure/06-VERIFICATION.md
@src/cli/canonical.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix README.md stale configs/common/ references</name>
  <files>README.md</files>
  <action>
    Update 3 stale references in README.md:

    1. Line 25: `cp configs/common/commands/zz-sync-agent-configs.md \` → `cp configs/commands/zz-sync-agent-configs.md \`
    2. Line 32: `cp configs/common/commands/zz-sync-agent-configs.md \` → `cp configs/commands/zz-sync-agent-configs.md \`
    3. Lines 58-64: Replace the directory layout section. Change:
       ```
       configs/common/
         commands/*.md              17 slash commands
         agents/*.md                8 agent definitions
         skills/                    2 skill directories
         mcp/*.json                 6 MCP server definitions
         settings/*.json            2 settings definitions (claude, opencode)
       ```
       To:
       ```
       configs/
         commands/*.md              17 slash commands
         agents/*.md                8 agent definitions
         skills/                    2 skill directories
         mcp/*.json                 6 MCP server definitions
         settings/*.json            2 settings definitions (claude, opencode)
         instructions/*.md          4 per-CLI instruction addendums
       ```

    After edits, verify: `grep -n 'configs/common' README.md` returns zero matches.
  </action>
  <verify>grep -c 'configs/common' README.md returns 0</verify>
  <done>README.md has zero configs/common/ references; setup instructions and directory layout show configs/ paths</done>
</task>

<task type="auto">
  <name>Task 2: Wire path constants from canonical.ts into render.ts, pull.ts, check.ts</name>
  <files>src/cli/render.ts, src/cli/pull.ts, src/cli/check.ts</files>
  <action>
    Import path constants from canonical.ts and replace hardcoded `join(projectDir, 'configs', ...)` patterns.

    **canonical.ts exports (already exist — do NOT modify):**
    ```ts
    export const COMMANDS_DIR = join(CANONICAL_ROOT, 'commands');  // = 'configs/commands'
    export const AGENTS_DIR = join(CANONICAL_ROOT, 'agents');      // = 'configs/agents'
    export const SKILLS_DIR = join(CANONICAL_ROOT, 'skills');      // = 'configs/skills'
    export const MCP_DIR = join(CANONICAL_ROOT, 'mcp');
    export const INSTRUCTIONS_DIR = join(CANONICAL_ROOT, 'instructions');
    export const SETTINGS_DIR = join(CANONICAL_ROOT, 'settings');
    ```

    Note: These are RELATIVE paths (e.g. `'configs/commands'`), not absolute. Usage pattern: `join(projectDir, COMMANDS_DIR, filename)`.

    **render.ts (1 change):**
    - Add to existing imports from `'./canonical.js'`: `COMMANDS_DIR, AGENTS_DIR` (or whichever constants the current `dirName` maps to)
    - Line 134: `join(projectDir, 'configs', dirName, ...)` — the `dirName` variable is dynamic (comes from a type-to-directory mapping). Check what values `dirName` takes. If it's always one of `'commands'`/`'agents'`, replace with the corresponding constant. If it's a dynamic lookup, consider whether a map from type to constant is cleaner. Use judgment — if the dynamic lookup is cleaner than a switch/map, keep the existing pattern but add a comment noting the constants exist. Don't force it.

    **pull.ts (9 changes):**
    - Add import: `import { COMMANDS_DIR, AGENTS_DIR, SKILLS_DIR } from './canonical.js';`
    - Line 72: `join(projectDir, 'configs', 'commands')` → `join(projectDir, COMMANDS_DIR)`
    - Line 79: `join(projectDir, 'configs', 'agents')` → `join(projectDir, AGENTS_DIR)`
    - Line 86: `join(projectDir, 'configs', 'skills')` → `join(projectDir, SKILLS_DIR)`
    - Line 106: `join(projectDir, 'configs', 'commands', ...)` → `join(projectDir, COMMANDS_DIR, ...)`
    - Line 121: `join(projectDir, 'configs', 'agents', ...)` → `join(projectDir, AGENTS_DIR, ...)`
    - Line 138: `join(projectDir, 'configs', 'skills', ...)` → `join(projectDir, SKILLS_DIR, ...)`
    - Line 174: `join(projectDir, 'configs', 'commands')` → `join(projectDir, COMMANDS_DIR)`
    - Line 181: `join(projectDir, 'configs', 'agents')` → `join(projectDir, AGENTS_DIR)`
    - Line 186: `join(projectDir, 'configs', 'skills', ...)` → `join(projectDir, SKILLS_DIR, ...)`

    **check.ts (2 changes):**
    - Add import: `import { COMMANDS_DIR, AGENTS_DIR } from './canonical.js';`
    - Line 142: `join(projectDir, 'configs', 'commands', ...)` → `join(projectDir, COMMANDS_DIR, ...)`
    - Line 163: `join(projectDir, 'configs', 'agents', ...)` → `join(projectDir, AGENTS_DIR, ...)`

    After edits, verify: `grep -rn "join(projectDir, 'configs'" src/cli/{render,pull,check}.ts` returns zero matches (all replaced with constants).
  </action>
  <verify>grep -c "join(projectDir, 'configs'" src/cli/render.ts src/cli/pull.ts src/cli/check.ts returns 0 for each file; bun test still passes (no regressions)</verify>
  <done>All 3 files import path constants from canonical.ts; zero hardcoded 'configs' strings in join() calls; exported constants from canonical.ts are no longer orphaned</done>
</task>

</tasks>

<verification>
1. `grep -rn 'configs/common' README.md src/cli/*.ts` returns zero matches
2. `grep -rn "join(projectDir, 'configs'" src/cli/render.ts src/cli/pull.ts src/cli/check.ts` returns zero matches
3. `grep -rn "import.*_DIR.*from.*canonical" src/cli/pull.ts src/cli/check.ts` confirms imports exist
4. `bun test` passes (zero regressions from constant wiring)
</verification>

<success_criteria>
- README.md: 0 stale configs/common/ references
- render.ts: imports path constants from canonical.ts (or documents why dynamic lookup is preferred)
- pull.ts: 9 hardcoded 'configs' strings replaced with COMMANDS_DIR/AGENTS_DIR/SKILLS_DIR imports
- check.ts: 2 hardcoded 'configs' strings replaced with COMMANDS_DIR/AGENTS_DIR imports
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-flatten-canonical-structure/06-02-SUMMARY.md`
</output>
